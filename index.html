<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=2.0, user-scalable=yes">
    <title>Presentación: Educación en Ambientes Virtuales</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;1,400&family=Source+Sans+Pro:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    
    <!-- Reveal.js CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@4.3.1/dist/reset.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@4.3.1/dist/reveal.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@4.3.1/dist/theme/white.css" id="theme-base">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="styles/styles.css">
    <link rel="stylesheet" href="styles/dark-theme.css">
    <link rel="stylesheet" href="styles/icon-fix.css">
    <link rel="stylesheet" href="styles/theme-toggle.css">
    <link rel="stylesheet" href="styles/language-toggle.css">
    <link rel="stylesheet" href="styles/language-loading.css">
    <link rel="stylesheet" href="styles/index-slide.css">
    <link rel="stylesheet" href="styles/index-navigation.css">
    <link rel="stylesheet" href="styles/lms-gallery.css">
    <link rel="stylesheet" href="styles/blue-index-button.css">
    <link rel="stylesheet" href="styles/loader-fix.css">
    <link rel="stylesheet" href="styles/loading-overlay-fix.css">
    <link rel="stylesheet" href="styles/absolute-grid-center.css">
    
    <!-- Emergency styling for language toggle -->
    <style>
        #language-toggle-btn {
            cursor: pointer !important;
            user-select: none !important;
        }
        
        /* Make toggle more noticeable */
        #language-toggle-btn:hover {
            transform: scale(1.05) !important;
            box-shadow: 0 0 8px rgba(0, 119, 204, 0.6) !important;
        }
        
        #language-toggle-btn:active {
            transform: scale(0.95) !important;
        }
        
        /* Ensure proper loading state appearance */
        body.language-loading #language-loading-indicator {
            display: block !important;
            opacity: 1 !important;
        }
        
        /* Ensure language toggle stays visible during loading */
        body.language-loading #language-toggle-btn,
        body.language-loading .theme-toggle-wrapper {
            z-index: 10001 !important;
        }
        
        /* Prevent any content flashing during loading */
        .reveal .slides {
            transition: opacity 0.1s ease-out;
        }
        
        body.language-loading .reveal .slides {
            opacity: 0 !important;
            visibility: hidden !important;
        }
    </style>
    
    <!-- Emergency styling for index button - BLUE and TOP LEFT -->
    <style>
        /* Force blue index button in top left */
        .back-to-index {
            position: absolute !important;
            top: 10px !important;
            left: 10px !important;
            right: auto !important;
            bottom: auto !important;
            z-index: 9999 !important;
            color: #0077cc !important;
            width: auto !important;
            display: inline-flex !important;
            align-items: center !important;
            padding: 5px 8px !important;
        }
        
        .back-to-index i {
            color: #0077cc !important;
        }
        
        /* Override any conflicting styles */
        .reveal .slides section .back-to-index {
            position: absolute !important;
            top: 10px !important;
            left: 10px !important;
            z-index: 9999 !important;
            width: auto !important;
            max-width: none !important;
        }
        
        /* Fix for dark theme */
        .dark-theme .back-to-index,
        .dark-theme .back-to-index i {
            color: #0099ff !important;
        }
        
        /* Make it more visible */
        .back-to-index:hover {
            opacity: 1 !important;
            transform: scale(1.05) !important;
            background-color: rgba(255, 255, 255, 0.4) !important;
        }
    </style>
    
    <!-- Emergency styling for loader centering -->
    <style>
        /* Fix for spinner centering */
        .loading-section {
            display: flex !important;
            flex-direction: column !important;
            align-items: center !important;
            justify-content: center !important;
            height: 100vh !important;
            width: 100% !important;
            text-align: center !important;
        }
        
        .loader {
            margin: 0 auto !important;
            display: block !important;
            position: relative !important;
            left: 0 !important;
            right: 0 !important;
        }
        
        /* Make spinner more visible */
        .loader {
            width: 4rem !important;
            height: 4rem !important;
            border-width: 0.35rem !important;
        }
        
        /* Language loading spinner also needs centering */
        .loading-spinner {
            margin: 0 auto 1rem auto !important;
        }
        
        /* Ensure the language loading indicator is properly centered */
        #language-loading-indicator {
            display: grid !important;
            place-items: center !important;
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            background-color: rgba(0, 0, 0, 0.85) !important;
            z-index: 999999 !important;
            margin: 0 !important;
            padding: 0 !important;
        }
        
        /* Ensure body is locked during loading */
        body.language-loading {
            overflow: hidden !important;
            position: fixed !important;
            width: 100% !important;
            height: 100% !important;
        }
    </style>
    
    <!-- Emergency styling for loader disappearing -->
    <style>
        /* Force loading indicators to disappear if they get stuck */
        #language-loading-indicator {
            transition: opacity 0.3s ease-out !important;
        }
        
        /* Force removal after language change finishes */
        body:not(.language-loading) #language-loading-indicator,
        body:not(.language-loading-active) #language-loading-indicator {
            display: none !important;
            opacity: 0 !important;
            visibility: hidden !important;
            pointer-events: none !important;
        }
        
        /* Force removal with animation classes too */
        .language-change-complete #language-loading-indicator {
            display: none !important;
        }
    </style>
    
    <!-- Emergency styling to prevent icon/title overlap -->
    <!-- Emergency styling for title and icon positioning -->
    <style>
        /* Prevent icons from overlapping titles by adjusting positions */
        .reveal .slides section:not(.title-slide) h2 {
            margin-top: 2.5rem !important; /* Add space above title */
            padding-right: 2.5rem !important; /* Keep space for the icon */
        }
        
        .reveal .slides section:not(.title-slide) .slide-icon {
            top: 5px !important; /* Position higher than title */
            font-size: 2rem !important; /* Slightly smaller */
            opacity: 0.6 !important; /* More subtle */
        }
        
        /* Keep title slide icon as is */
        .reveal .slides section.title-slide .slide-icon {
            position: static !important;
            margin: 0.8rem auto 1.5rem auto !important;
            font-size: 5rem !important;
            opacity: 0.9 !important;
        }
        
        /* Ensure buttons are properly positioned as well */
        .back-to-index {
            top: 5px !important;
        }
    </style>
    
    <!-- Emergency styling for loading overlay to cover full screen and block clicks -->
    <style>
        /* Full-screen overlay that blocks clicks */
        #language-loading-indicator {
            display: grid !important;
            place-items: center !important;
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            background-color: rgba(0, 0, 0, 0.85) !important;
            z-index: 999999 !important;
            margin: 0 !important;
            padding: 0 !important;
        }
        
        body.language-loading {
            overflow: hidden !important;
            position: fixed !important;
            width: 100% !important;
            height: 100% !important;
        }
    </style>
    
    <!-- Add additional emergency script -->
    <script>
        // Emergency check for back-to-index buttons
        window.backToIndexEmergencyCheck = function() {
            console.log("Running emergency check for index buttons");
            const slides = document.querySelectorAll('.reveal .slides > section:not(.title-slide):not(.index-slide)');
            const currentLang = document.documentElement.lang || 'es';
            const buttonTitle = currentLang === 'en' ? 'Back to index' : 'Volver al índice';
            
            slides.forEach(slide => {
                if (!slide.querySelector('.back-to-index')) {
                    const backButton = document.createElement('div');
                    backButton.className = 'back-to-index';
                    backButton.innerHTML = '<i class="fas fa-list"></i>';
                    backButton.title = buttonTitle;
                    backButton.style.cssText = 'position:absolute !important; top:10px !important; left:10px !important; z-index:10000 !important; cursor:pointer !important; font-size:1.2rem; color:#0077cc !important; opacity:0.7; transition:all 0.3s ease; padding:5px 8px !important; border-radius:3px; background-color:rgba(255,255,255,0.2); display:inline-flex !important; align-items:center; width:auto !important; max-width:none !important;';
                    backButton.onclick = function(e) {
                        e.stopPropagation();
                        Reveal.slide(1);
                    };
                    slide.insertBefore(backButton, slide.firstChild);
                }
                
                // Make sure existing buttons are properly styled
                const existingButton = slide.querySelector('.back-to-index');
                if (existingButton) {
                    existingButton.style.position = 'absolute';
                    existingButton.style.top = '10px';
                    existingButton.style.left = '10px';
                    existingButton.style.color = '#0077cc';
                    existingButton.style.zIndex = '9999';
                    
                    // Force icon color
                    const icon = existingButton.querySelector('i');
                    if (icon) {
                        icon.style.color = '#0077cc';
                    }
                }
            });
        };
        
        // Set up periodic checks
        window.addEventListener('load', function() {
            // Initial checks
            setTimeout(window.backToIndexEmergencyCheck, 500);
            setTimeout(window.backToIndexEmergencyCheck, 1500);
            setTimeout(window.backToIndexEmergencyCheck, 3000);
            
            // Periodic check
            setInterval(window.backToIndexEmergencyCheck, 5000);
        });
    </script>
    
    <!-- Emergency script for blue index button in top left -->
    <script>
        // Immediately apply index button positioning and color
        (function() {
            function emergencyFixIndexButtons() {
                console.log("Fixing index buttons - BLUE + TOP LEFT");
                var buttons = document.querySelectorAll('.back-to-index');
                for (var i = 0; i < buttons.length; i++) {
                    buttons[i].style.position = 'absolute';
                    buttons[i].style.top = '10px';
                    buttons[i].style.left = '10px';
                    buttons[i].style.right = 'auto';
                    buttons[i].style.bottom = 'auto';
                    buttons[i].style.zIndex = '9999';
                    buttons[i].style.color = '#0077cc';
                    buttons[i].style.width = 'auto';
                    buttons[i].style.display = 'inline-flex';
                    buttons[i].style.alignItems = 'center';
                    
                    // Force icon color to blue
                    var icon = buttons[i].querySelector('i');
                    if (icon) {
                        icon.style.color = '#0077cc';
                    }
                }
            }
            
            // Run immediately
            emergencyFixIndexButtons();
            
            // Run after a delay
            setTimeout(emergencyFixIndexButtons, 500);
            setTimeout(emergencyFixIndexButtons, 1000);
            setTimeout(emergencyFixIndexButtons, 2000);
            
            // Run after page load
            window.addEventListener('load', function() {
                emergencyFixIndexButtons();
                setTimeout(emergencyFixIndexButtons, 500);
                
                // Listen for Reveal.js events
                if (typeof Reveal !== 'undefined') {
                    Reveal.addEventListener('slidechanged', emergencyFixIndexButtons);
                    Reveal.addEventListener('ready', emergencyFixIndexButtons);
                }
                
                // Set up periodic checks
                setInterval(emergencyFixIndexButtons, 3000);
            });
            
            // Make available globally
            window.emergencyFixIndexButtons = emergencyFixIndexButtons;
        })();
    </script>
    
    <!-- Emergency script to force-hide loading indicators -->
    <script>
        // Force hide any stuck loading indicators
        (function() {
            // Create a function to force hide any loading indicators
            function forceHideLoading() {
                console.log("Emergency check for stuck loading indicators");
                
                // Remove any loading indicator that might be stuck
                const indicator = document.getElementById('language-loading-indicator');
                if (indicator) {
                    console.warn("Found stuck loading indicator, removing it");
                    indicator.remove();
                }
                
                // Also remove loading classes from body
                document.body.classList.remove('language-loading');
                document.body.classList.remove('language-loading-active');
                
                // Show slides if they were hidden
                const slidesContainer = document.querySelector('.reveal .slides');
                if (slidesContainer) {
                    slidesContainer.style.opacity = '';
                    slidesContainer.style.visibility = '';
                }
                
                // Add completed class
                document.body.classList.add('language-change-complete');
            }
            
            // Set up periodic checks and timeline-based checks
            window.addEventListener('load', function() {
                // Check after 10 seconds no matter what
                setTimeout(forceHideLoading, 10000);
                
                // Also check on slide changes
                if (typeof Reveal !== 'undefined') {
                    Reveal.addEventListener('slidechanged', function() {
                        // If we're changing slides, we should be done loading
                        forceHideLoading();
                    });
                    
                    Reveal.addEventListener('ready', function() {
                        // If Reveal is ready, we should be done loading
                        forceHideLoading();
                    });
                }
                
                // Listen for any click on the document as a last resort
                document.addEventListener('click', function() {
                    const indicator = document.getElementById('language-loading-indicator');
                    if (indicator && !document.body.classList.contains('language-loading-active')) {
                        forceHideLoading();
                    }
                });
            });
            
            // Make available globally
            window.forceHideLoading = forceHideLoading;
        })();
    </script>
    
    <!-- Emergency script to fix icon positioning -->
    <script>
        function emergencyIconTitleFix() {
            console.log("Running emergency icon/title positioning fix");
            
            // Fix slide icons to prevent overlap with titles
            document.querySelectorAll('.reveal .slides section:not(.title-slide) .slide-icon').forEach(icon => {
                icon.style.top = '5px';
                icon.style.fontSize = '2rem';
                icon.style.opacity = '0.6';
            });
            
            // Add space above titles
            document.querySelectorAll('.reveal .slides section:not(.title-slide) h2').forEach(title => {
                title.style.marginTop = '2.5rem';
                title.style.paddingRight = '2.5rem';
            });
            
            // Keep title slide icon as is
            document.querySelectorAll('.reveal .slides section.title-slide .slide-icon').forEach(icon => {
                icon.style.position = 'static';
                icon.style.margin = '0.8rem auto 1.5rem auto';
                icon.style.textAlign = 'center';
                icon.style.display = 'block';
                icon.style.fontSize = '5rem';
                icon.style.opacity = '0.9';
            });
        }
        
        // Run on page load and after slides are created
        window.addEventListener('load', function() {
            setTimeout(emergencyIconTitleFix, 500);
            setTimeout(emergencyIconTitleFix, 1500);
            
            // Also run when slides change
            if (typeof Reveal !== 'undefined') {
                Reveal.addEventListener('slidechanged', emergencyIconTitleFix);
                Reveal.addEventListener('ready', emergencyIconTitleFix);
            }
        });
        
        // Make available globally
        window.emergencyIconTitleFix = emergencyIconTitleFix;
    </script>
    
    <!-- Core functionality scripts -->
    <script src="js/date-formatter.js"></script>
    <script src="js/language-toggle.js"></script>
    <script src="js/theme-toggle.js"></script>
    <script src="js/presentation.js"></script>
    <script src="js/index-navigation.js"></script>
    <script src="js/lms-interactions.js"></script>
    
    <!-- Emergency script to ensure language toggle works -->
    <script>
        // Wait for everything to load
        window.addEventListener('load', function() {
            // Verify toggle is initialized
            setTimeout(function() {
                const toggleBtn = document.getElementById('language-toggle-btn');
                if (toggleBtn && !toggleBtn.hasAttribute('data-language-toggle-initialized')) {
                    console.warn('Language toggle initialization failed in normal flow, applying fallback');
                    
                    // Define global fallback if it doesn't exist
                    if (typeof window.handleLanguageToggle !== 'function') {
                        window.handleLanguageToggle = function() {
                            console.log('Using emergency language toggle handler');
                            
                            // Get current language and switch
                            const currentLang = localStorage.getItem('presentationLanguage') || 'es';
                            const newLang = currentLang === 'es' ? 'en' : 'es';
                            
                            // Store preference
                            localStorage.setItem('presentationLanguage', newLang);
                            
                            // Update UI
                            const textElement = toggleBtn.querySelector('.language-text');
                            if (textElement) {
                                textElement.textContent = newLang.toUpperCase();
                            }
                            
                            // Reload page - simplest solution
                            location.reload();
                        };
                    }
                    
                    // Apply handler directly
                    toggleBtn.onclick = function() {
                        window.handleLanguageToggle();
                        return false;
                    };
                    
                    toggleBtn.setAttribute('data-language-toggle-initialized', 'true');
                }
            }, 2000);
        });
    </script>
    
    <!-- Improved loading indicator that blocks clicks and covers screen -->
    <script>
        // Override the showLanguageLoadingIndicator function with a grid-based one
        window.showLanguageLoadingIndicator = function() {
            console.log("Creating grid-centered loading indicator");
            
            // Remove any existing indicator
            const existingIndicator = document.getElementById('language-loading-indicator');
            if (existingIndicator) {
                existingIndicator.remove();
            }
            
            // Create a new indicator with grid-based centering
            const indicator = document.createElement('div');
            indicator.id = 'language-loading-indicator';
            
            // Apply critical inline styles
            indicator.style.cssText = 
                "display: grid !important;" +
                "place-items: center !important;" +
                "position: fixed !important;" +
                "top: 0 !important;" +
                "left: 0 !important;" +
                "right: 0 !important;" +
                "bottom: 0 !important;" +
                "width: 100vw !important;" +
                "height: 100vh !important;" +
                "background-color: rgba(0, 0, 0, 0.85) !important;" +
                "z-index: 999999 !important;" +
                "margin: 0 !important;" +
                "padding: 0 !important;" +
                "pointer-events: all !important;";
            
            // Create inner content with fixed width to prevent shifting
            const innerContent = document.createElement('div');
            innerContent.style.cssText = 
                "width: 300px !important;" +
                "margin: 0 !important;" +
                "padding: 0 !important;" +
                "text-align: center !important;";
            
            // Create spinner
            const spinner = document.createElement('div');
            spinner.style.cssText = 
                "width: 6rem !important;" +
                "height: 6rem !important;" +
                "border: 0.4rem solid rgba(255, 255, 255, 0.3) !important;" +
                "border-top-color: #0077cc !important;" +
                "border-radius: 50% !important;" +
                "margin: 0 auto 2rem auto !important;" +
                "animation: spin 1s linear infinite !important;";
            
            // Create text
            const text = document.createElement('div');
            text.style.cssText = 
                "color: white !important;" +
                "font-size: 1.6rem !important;" +
                "font-weight: 500 !important;" +
                "text-align: center !important;" +
                "width: 100% !important;" +
                "margin: 0 !important;" +
                "padding: 0 !important;";
            text.textContent = "Cambiando idioma / Changing language...";
            
            // Assemble the elements
            innerContent.appendChild(spinner);
            innerContent.appendChild(text);
            indicator.appendChild(innerContent);
            
            // Add to body
            document.body.appendChild(indicator);
            
            // Add loading classes to body
            document.body.classList.add('language-loading');
            document.body.classList.add('language-loading-active');
            
            console.log('Grid-centered loading indicator displayed');
        };
    </script>
</head>
<body>
    <!-- Theme Toggle Switch -->
    <div class="theme-toggle-wrapper">
        <i class="fas fa-sun theme-icon sun-icon" aria-hidden="true"></i>
        <label class="theme-switch">
            <input type="checkbox" id="theme-toggle">
            <span class="slider"></span>
        </label>
        <i class="fas fa-moon theme-icon moon-icon" aria-hidden="true"></i>
    </div>

    <!-- Language Toggle Button - improved structure with direct onclick handler -->
    <div id="language-toggle-btn" class="language-toggle-wrapper" tabindex="0" role="button" 
         aria-label="Change language" onclick="if(typeof handleLanguageToggle==='function')handleLanguageToggle()">
        <i class="fas fa-language language-icon" aria-hidden="true"></i>
        <span class="language-text">ES</span>
    </div>

    <div class="reveal">
        <div class="slides" id="presentation-slides">
            <!-- Slides will be loaded dynamically -->
            <section class="loading-section">
                <h2>Cargando presentación...</h2>
                <div class="loader"></div>
            </section>
        </div>
    </div>

    <!-- Additional noscript warning for JavaScript disabled browsers -->
    <noscript>
        <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: white; color: black; z-index: 9999; padding: 2rem; text-align: center; font-family: sans-serif;">
            <h2>JavaScript es necesario</h2>
            <p>Esta presentación requiere JavaScript para funcionar. Por favor, habilite JavaScript en su navegador.</p>
            <hr>
            <h2>JavaScript is required</h2>
            <p>This presentation requires JavaScript to function. Please enable JavaScript in your browser.</p>
        </div>
    </noscript>

    <!-- Reveal.js Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/reveal.js@4.3.1/dist/reveal.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/reveal.js@4.3.1/plugin/markdown/markdown.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/reveal.js@4.3.1/plugin/highlight/highlight.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/reveal.js@4.3.1/plugin/notes/notes.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/reveal.js@4.3.1/plugin/zoom/zoom.js"></script>

    <!-- Core functionality scripts -->
    <script src="js/date-formatter.js"></script>
    <script src="js/language-toggle.js"></script>
    <script src="js/theme-toggle.js"></script>
    <script src="js/presentation.js"></script>
    <script src="js/index-navigation.js"></script>
</body>
</html>
